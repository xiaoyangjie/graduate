{% extends 'total_index/common.html' %}
{% load static %}
    {% block title %}Twitter数据查询{% endblock %}
    {% block link %}
    {% endblock %}

    {% block body %}

{#        <div id="Layer1" style="position:absolute; left:0; top:0; width:100%; height:100%">#}
{#        <img src="/static/twitter/twitter_background.jpg" width="100%" height="100%"/>#}
{#        </div>#}

        <div id="wrapper">
            <p><span style="display:inline-block;width:130px;text-align:right;">type:</span><input type="text" id="type" size="60" maxlength="120"></p>
            <p><span style="display:inline-block;width:130px;text-align:right;">userDatabase:</span><input type="text" id="userDatabase"></p>
            <p><span style="display:inline-block;width:130px;text-align:right;">userCollection:</span><input type="text" id="userCollection"></p>
            <p><span style="display:inline-block;width:130px;text-align:right;">screenNameList:</span><input type="text" id="screenNameList"></p>
            <p><span style="display:inline-block;width:130px;text-align:right;">accountIdList:</span><input type="text" id="accountIdList"></p>
            <p><span style="display:inline-block;width:130px;text-align:right;">tweetDatabase:</span><input type="text" id="tweetDatabase"></p>
            <p><span style="display:inline-block;width:130px;text-align:right;">tweetCollection:</span><input type="text" id="tweetCollection" ></p>
            <br>
            <br>
            <br>
            <button type="button" id='twitterButton'>显示数据</button>
            <button type="button" id='realtimeButton'>显示实时数据</button>
            <button type="button" id='finishButton'>结束显示实时数据</button>
            <button type="button" id='clearButton'>清除数据</button>

            <div class="block" style="height: 900px;background-color: rgba(10, 17, 45, 0.11);padding: 15px 15px;
            box-shadow: 0 0 14px #B1ABAB;margin: 10px 0;"><p><span id='twitterQuery'></span></p></div>

            <br>
            <br>
            <br>
        </div>
        <script src="/static/jquery_1.11.1.js"></script>
        <script>
        var totalViewNum = 10;
        var dataList = [];

{#        var screenNameList = $("#screenNameList").val();#}
{#        var accountIdList = $("#accountIdList").val();#}
{#        var userDatabase = $("#userDatabase").val();#}
{#        var userCollection = $("#userCollection").val();#}
{#        var tweetDatabase = $("#tweetDatabase").val();#}
{#        var tweetCollection = $("#tweetCollection").val();#}
{#        var keywords = $("#keywords").val();#}
{#        var type = $("#type").val();#}
        var timeOut = false;
            $(document).ready(function(){
                $("#realtimeButton").click(function(){
{#                    获取用户信息定时任务#}
                    timeOut = false;
                    time();
                    $("#finishButton").click(function(){
                         timeOut = true;
                    });
                });
{#                清空显示数据#}
                $("#clearButton").click(function(){
                    $('#twitterQuery').empty();
                    dataList = [];
                });

            });
            function time() {
                if(timeOut) return;
                clock();
                setTimeout(time,3000); //time是指本身,延时递归调用自己,100为间隔调用时间,单位毫秒
            }
{#                    获取用户信息定时任务方法#}
            function clock(){
                var tweetDatabase = $("#tweetDatabase").val();
                var tweetCollection = $("#tweetCollection").val();
                var type = $("#type").val();
                var dataContent = "";
                $.get("/twitter/realtimeInfoGet/",{'tweetDatabase':tweetDatabase,'tweetCollection':tweetCollection
                ,'type':type}, function(data) {
{#                for (var i = 0; i < data.length; i++) {#}
{#                    $.each(data[i], function (key, value) {#}
{#                        $('#twitterQuery').append(key + '----------' + value + '<br>')#}
{#                    });#}
{#                }#}
                var str = "";
                if (data['level'] == 'error'){
                    timeOut = true;
                    str = str + data['content'];
                    dataContent = str;
                }
                else{
                    $.each(data, function (key, value) {
                        str += '<br>' + key + '----------' + value + '<br>';
                    });
                    dataList.push(str);
                  {#    超出了设定的可视化条数范围，就删除dataList前面的数据#}
                if (dataList.length > totalViewNum){
                    dataList.shift();
                }
                dataContent = "";
                for (var i = 0 ; i < dataList.length ;i++){
                    dataContent += dataList[i];
                }
                }
                $('#twitterQuery').html(dataContent);
            });
        }
        </script>

    {% endblock %}